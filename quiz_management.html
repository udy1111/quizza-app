<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Logo.png">
    <title>Quiz Management</title>
    <link rel="stylesheet" href="Style.css">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <header class="management">
        <img src="Logo.png" alt="Quizza Logo" class="Logo">
        <div class="profile-dropdown">
            <img src="profile-placeholder.png" alt="Profile">
            <div class="profile-dropdown-content">
                <a href="profile.html">Profile</a>
                <a href="logout.php">Logout</a>
            </div>
        </div>
    </header>
    <main>
        <h1>Quiz Creation and Management</h1>
        <div class="container">
            <section>
                <div class="container">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="p-3 bg-dark text-light border">Column 1<span id="totalUsers"></span></div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3 bg-dark text-light border">Column 2<span id="totalQuestions"></spa>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3 bg-dark text-light border">Column 3<span id="totalAnswers"></spa>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="category">
                <div id="categoryResponse"></div>
                <h2>Quiz Categories</h2>
                <p>Manage your quiz categories here.</p>
                <form id="categoryForm">
                    <label for="new-category">Add New Category:</label>
                    <input type="text" id="new-category" name="category_name" required>
                    <button type="submit">Add Category</button>
                </form>
                <br><br>
                <h3>Existing Categories</h3>
                <hr>
                <ul id="categoryList" class="list-group">
                    <!-- Categories will be appended here -->
                </ul>
            </section>
            <br><br>
            <section class="quiz-editor">
                <h2>Quiz Questions</h2>
                <form id="quizForm">
                    <label for="quiz-category">Select Quiz Category:</label>
                    <select id="quiz-category" name="quiz-category" required>
                        <!-- Options will be dynamically added here -->
                    </select>
                    <div class="form-group">
                        <label for="questionText">Question Text:</label>
                        <textarea id="questionText" name="question_text" class="form-control" rows="3"
                            required></textarea>
                    </div>
                    <!-- Options -->
                    <center>
                        <button type="button" id="multi" onclick="multidatafunc()">Multi choice</button>
                        <button type="button" id="bool" onclick="booldatafunc()">True/False</button>
                    </center>
                    <br>
                    <div class="form-group" id="multidata" style="display: none;">
                        <label>Options:</label>
                        <div id="multiOptionsContainer">
                            <div class="form-check">
                                <input type="radio" id="option1_correct_multi" name="correct_option" value="1"
                                    class="form-check-input">
                                <label for="option1_correct_multi" class="form-check-label">Option 1</label>
                                <input type="text" id="option1_text_multi" name="option_text1" class="form-control"
                                    placeholder="Option 1">
                            </div>
                            <div class="form-check mt-2">
                                <input type="radio" id="option2_correct_multi" name="correct_option" value="2"
                                    class="form-check-input">
                                <label for="option2_correct_multi" class="form-check-label">Option 2</label>
                                <input type="text" id="option2_text_multi" name="option_text2" class="form-control"
                                    placeholder="Option 2">
                            </div>
                            <div class="form-check mt-2">
                                <input type="radio" id="option3_correct_multi" name="correct_option" value="3"
                                    class="form-check-input">
                                <label for="option3_correct_multi" class="form-check-label">Option 3</label>
                                <input type="text" id="option3_text_multi" name="option_text3" class="form-control"
                                    placeholder="Option 3">
                            </div>
                            <div class="form-check mt-2">
                                <input type="radio" id="option4_correct_multi" name="correct_option" value="4"
                                    class="form-check-input">
                                <label for="option4_correct_multi" class="form-check-label">Option 4</label>
                                <input type="text" id="option4_text_multi" name="option_text4" class="form-control"
                                    placeholder="Option 4">
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="booldata" style="display: none;">
                        <label>Options:</label>
                        <div id="boolOptionsContainer">
                            <div class="form-check">
                                <input type="radio" id="option1_correct_bool" name="correct_option" value="true"
                                    class="form-check-input">
                                <label for="option1_correct_bool" class="form-check-label">True</label>
                            </div>
                            <div class="form-check mt-2">
                                <input type="radio" id="option2_correct_bool" name="correct_option" value="false"
                                    class="form-check-input">
                                <label for="option2_correct_bool" class="form-check-label">False</label>
                            </div>
                        </div>
                    </div>
                    <button type="submit">Save Quiz</button>
                </form>
                <!-- Question Text -->
            </section>
            <section class="social-sharing">
                <h2>Social Sharing</h2>
                <p>Share your quiz results on social media.</p>
                <div class="sharing-options">
                    <button type="button">Share on Facebook</button>
                    <button type="button">Share on Twitter</button>
                    <button type="button">Share on LinkedIn</button>
                    <button type="button">Share via Email</button>
                    <!-- Add more sharing options as needed -->
                </div>
            </section>
            <section class="leaderboard">
                <h2>Leaderboards</h2>
                <p>Compete with friends or globally.</p>
                <h3>Top Performers</h3>
                <ol>
                    <li>John Doe - 95%</li>
                    <li>Jane Smith - 90%</li>
                    <li>Sam Brown - 85%</li>
                    <!-- Add more top performers as needed -->
                </ol>
                <h3>Your Friends</h3>
                <ul>
                    <li>Friend 1 - 88%</li>
                    <li>Friend 2 - 84%</li>
                    <li>Friend 3 - 80%</li>
                    <!-- Add more friends as needed -->
                </ul>
            </section>
            <section class="analytics">
                <h2>Basic Analytics</h2>
                <p>Track quiz performance.</p>
                <div class="analytics-info">
                    <h3>Quiz Statistics</h3>
                    <p>Total Quizzes Created: 25</p>
                    <p>Total Quizzes Taken: 100</p>
                    <p>Average Score: 78%</p>
                    <p>Highest Score: 100%</p>
                    <p>Lowest Score: 50%</p>
                    <!-- Add more analytics details as needed -->
                </div>
            </section>
        </div>
    </main>
    <script>



        var totalAnswers = document.getElementById('totalAnswers');
        var totalQuestions = document.getElementById('totalQuestions');
        var totalUsers = document.getElementById('totalUsers');














        document.getElementById('categoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const category_name = document.getElementById('new-category').value;
            const categoryResponse = document.getElementById('categoryResponse');

            try {
                const response = await fetch('https://quizza-rest-api.onrender.com/category', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ category_name }),
                });

                if (response.ok) {
                    const data = await response.json();
                    categoryResponse.innerHTML = `<span class="alert alert-success"><strong>${data.category_name}</strong> Category has been Created</span>`;
                    console.log('Category added:', data.category_name);
                    getAllCategories();
                    getAllCategoriesDropdown()
                } else {
                    const data = await response.json();
                    categoryResponse.innerHTML = `<span class="alert alert-danger">${data.category_name || 'An error occurred'}</span>`;
                    console.error('Error response:', data.category_name || 'An error occurred');
                }
            } catch (error) {
                categoryResponse.innerHTML = `<span class="alert alert-danger">An error occurred. Please try again later.</span>`;
                console.error('An error occurred:', error);
            }
        });


        // Get All Categories

        async function getAllCategories() {


            try {
                const response = await fetch('https://quizza-rest-api.onrender.com/category', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (response.ok) {
                    const data = await response.json();
                    categoryList.innerHTML = '';
                    data.forEach(category => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item category-item';

                        const text = document.createElement('span');
                        text.textContent = category.category_name;
                        text.className = 'category-text';
                        li.appendChild(text);

                        const deleteLink = document.createElement('a');
                        deleteLink.href = '#';
                        deleteLink.className = 'delete-link';

                        const i = document.createElement('i');
                        i.className = 'fa fa-trash delete-icon';
                        deleteLink.appendChild(i);

                        deleteLink.addEventListener('click', async (e) => {
                            e.preventDefault();
                            try {
                                const deleteResponse = await fetch(`https://quizza-rest-api.onrender.com/category/${category.id}`, {
                                    method: 'DELETE',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                });

                                if (deleteResponse.ok) {
                                    li.remove();
                                    totalQuestions.innerHTML = `Total Questions: ${data.length - 2}`; // Update the total questions count
                                    console.log(`Category ${category.category_name} deleted.`);
                                } else {
                                    const deleteData = await deleteResponse.json();
                                    console.error('Error response:', deleteData.message || 'An error occurred');
                                }
                            } catch (error) {
                                console.error('An error occurred:', error);
                            }
                        });

                        li.appendChild(deleteLink);
                        categoryList.appendChild(li);
                    });
                    totalQuestions.innerHTML = `Total Questions: ${data.length - 1}`;
                    console.log(data.length - 1);
                } else {
                    const data = await response.json();
                    categoryResponse.innerHTML = `<span class="alert alert-danger">${data.category_name || 'An error occurred'}</span>`;
                    console.error('Error response:', data.category_name || 'An error occurred');
                }
            } catch (error) {
                categoryResponse.innerHTML = `<span class="alert alert-danger">An error occurred. Please try again later.</span>`;
                console.error('An error occurred:', error);
            }


        }




        async function getAllCategoriesDropdown() {

            const categoryDropdown = document.getElementById('quiz-category');


            try {
                const response = await fetch('https://quizza-rest-api.onrender.com/category', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (response.ok) {
                    const data = await response.json();
                    categoryDropdown.innerHTML = '<option value="">--Select a Category--</option>';

                    data.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.category_name;
                        categoryDropdown.appendChild(option);
                    });
                } else {
                    const data = await response.json();
                    categoryResponse.innerHTML = `<span class="alert alert-danger">${data.category_name || 'An error occurred'}</span>`;
                    console.error('Error response:', data.category_name || 'An error occurred');
                }
            } catch (error) {
                categoryResponse.innerHTML = `<span class="alert alert-danger">An error occurred. Please try again later.</span>`;
                console.error('An error occurred:', error);
            }
        }



        var multidata = document.getElementById('multidata');
        var booldata = document.getElementById('booldata');

        function multidatafunc() {
            multidata.style.display = "block";
            booldata.style.display = "none";
        }

        function booldatafunc() {
            multidata.style.display = "none";
            booldata.style.display = "block";
        }

        document.getElementById('quizForm').addEventListener('submit', async function (event) {
            event.preventDefault();



            const multiOptions = document.querySelectorAll('#multidata input[type="text"]');
            const boolOptions = document.querySelectorAll('#booldata input[type="text"]');

            multiOptions.forEach(input => input.required = false);
            boolOptions.forEach(input => input.required = false);


            if (document.getElementById('multidata').style.display !== 'none') {
                multiOptions.forEach(input => input.required = true);
            } else if (document.getElementById('booldata').style.display !== 'none') {
                boolOptions.forEach(input => input.required = true);
            }

            const category = document.getElementById('quiz-category').value;
            const questionText = document.getElementById('questionText').value;

            const options = [];
            const correctOption = document.querySelector('input[name="correct_option"]:checked');

            if (document.getElementById('multidata').style.display !== 'none') {
                for (let i = 1; i <= 4; i++) {
                    const optionText = document.getElementById(`option${i}_text_multi`).value;
                    options.push({ text: optionText, is_correct: correctOption && correctOption.value === String(i) });
                }
            } else if (document.getElementById('booldata').style.display !== 'none') {
                options.push({ text: 'True', is_correct: correctOption && correctOption.value === 'true' });
                options.push({ text: 'False', is_correct: correctOption && correctOption.value === 'false' });
            }

            const payload = {
                category_id: category,
                question_text: questionText,
                options: options
            };

            try {
                const response = await fetch('https://quizza-rest-api.onrender.com/question', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    const data = await response.json();
                    alert('Quiz saved successfully!');
                    // Optionally, you can reset the form here
                    document.getElementById('quizForm').reset();
                } else {
                    const data = await response.json();
                    alert('Error: ' + (data.message || 'An error occurred'));
                }
            } catch (error) {
                console.error('An error occurred:', error);
                alert('An error occurred. Please try again later.');
            }
        });

        // function multidatafunc() {
        //     document.getElementById('multidata').style.display = 'block';
        //     document.getElementById('booldata').style.display = 'none';
        // }

        // function booldatafunc() {
        //     document.getElementById('multidata').style.display = 'none';
        //     document.getElementById('booldata').style.display = 'block';
        // }

















        getAllCategoriesDropdown();
        getAllCategories();



    </script>
</body>

</html>